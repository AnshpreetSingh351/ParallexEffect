<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Liquid Gyro Distortion</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    height: 100vh;
    overflow: hidden;
    background: #05070a;
    font-family: system-ui, sans-serif;
  }
  canvas {
    display: block;
    width: 100vw;
    height: 100vh;
  }
  .hint {
    position: fixed;
    bottom: 16px;
    width: 100%;
    text-align: center;
    color: #aaa;
    font-size: 14px;
    opacity: 0.8;
    pointer-events: none;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>
<div class="hint">Tilt your phone â€” liquid distortion ðŸ’§</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

let w, h, dpr;
function resize() {
  dpr = window.devicePixelRatio || 1;
  w = canvas.clientWidth = window.innerWidth;
  h = canvas.clientHeight = window.innerHeight;
  canvas.width = w * dpr;
  canvas.height = h * dpr;
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
window.addEventListener("resize", resize);
resize();

// Load image (you can replace this with your own)
const img = new Image();
img.src = "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1600&auto=format&fit=crop";

let targetX = 0, targetY = 0;
let curX = 0, curY = 0;

// Simple noise function
function noise(x, y, t) {
  return Math.sin(x * 0.02 + t) * Math.cos(y * 0.02 + t);
}

// Gyro handling
function handleOrientation(e) {
  const gamma = e.gamma || 0; // left-right
  const beta = e.beta || 0;   // front-back

  // Upright phone ~ beta 90, re-center
  const uprightBeta = beta - 90;

  targetX = Math.max(-30, Math.min(30, gamma));
  targetY = Math.max(-30, Math.min(30, uprightBeta));
}

// iOS permission
function requestPermissionIfNeeded() {
  if (
    typeof DeviceOrientationEvent !== "undefined" &&
    typeof DeviceOrientationEvent.requestPermission === "function"
  ) {
    DeviceOrientationEvent.requestPermission().then(response => {
      if (response === "granted") {
        window.addEventListener("deviceorientation", handleOrientation);
      } else {
        alert("Motion permission denied");
      }
    });
  } else {
    window.addEventListener("deviceorientation", handleOrientation);
  }
}

document.body.addEventListener("click", requestPermissionIfNeeded, { once: true });

let t = 0;

function animate() {
  t += 0.02;

  // Smooth easing
  curX += (targetX - curX) * 0.08;
  curY += (targetY - curY) * 0.08;

  ctx.clearRect(0, 0, w, h);

  if (img.complete) {
    // Draw image with distortion slices
    const sliceSize = 8; // smaller = smoother but heavier
    for (let y = 0; y < h; y += sliceSize) {
      for (let x = 0; x < w; x += sliceSize) {
        const n = noise(x, y, t);

        const dx = n * 10 + curX * 0.4;
        const dy = n * 10 + curY * 0.4;

        ctx.drawImage(
          img,
          (x / w) * img.width,
          (y / h) * img.height,
          (sliceSize / w) * img.width,
          (sliceSize / h) * img.height,
          x + dx,
          y + dy,
          sliceSize,
          sliceSize
        );
      }
    }
  }

  requestAnimationFrame(animate);
}

img.onload = () => animate();
</script>

</body>
</html>
